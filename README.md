# snapshotter

Simple package to collect obscured data from the private workspace inside foreign infrastructures.


### Installation

```bash
pip install git+https://github.com/pavooq/snapshotter.git
```

Current directory is a script workspace. Consider to change it before proceeding.


### Authorization

Server needs user authorizations for data collection to be possible. This is achieved in the three steps.

#### Slack application

Workspace owner needs to create a [Slack application][slack-apps] specifying workspace from which data collection will occur as it's development workspace. Set **SLACK_CLIENT_ID** and **SLACK_CLIENT_SECRET** environment variables to the values which you can find in «Basic Information» under «App Credentials».

#### Application backend

We'll launch a small web server in the workspace owner's infrastructure which will act as a backend for our temporary Slack application (all users will be must to manually copy OAuth authorization code from the redirect query without it).

```bash
snapshotter auth
```

Server will generate a redirect URL after it is launched: this URL must be added to the «Redirect URLs» under «OAuth & Permissions» in the application settings.

#### Access grant

Since data collection stage needs data from all channel types, including direct messages, [bot token][bot-token] capabilities are not sufficient for it. So data collection script will ask for the [user tokens][user-token] instead, and it needs them for the all users in the workspace.

> **NOTE**: data collection script doesn't need *all* user tokens actually, but it can not determine *which ones specifically* it needs until it collects them all.
>
> In fact, only one token per conversation is required. But since script can not know about private conversation's existence either without at least one token from it's members, it needs all user tokens to get the full list of conversations in the workspace.

Second URL generated by the server must be forwarded to the workspace members in order to receive OAuth tokens for them (it acts similarly to the «Add to Slack» button). Server will be able to count workspace members when the first token will arrive, showing you the count/total of the authorizations granted. Do not terminate server until count reaches total since it may result in partially collected data.

### Data collection

This step may take a while depending on workspace size.

```bash
snapshotter collect
```

Now remove *tokens.json*, review the data and send entire working directory to us.


[slack-apps]: https://api.slack.com/apps "Slack API: Applications"

[bot-token]: https://api.slack.com/authentication/token-types#bot "represents single installation"

[user-token]: https://api.slack.com/authentication/token-types#user "obviously represents a user"
